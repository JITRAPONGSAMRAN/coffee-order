<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡∏≤‡πÅ‡∏ü</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json" />
<!-- Favicon / Icon -->
<link rel="shortcut icon" href="icon-192.png" type="image/png" />
<meta name="theme-color" content="#6b4f2d" />

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  body { font-family: sans-serif; background: #f0f0f0; padding: 20px; max-width: 800px; margin: auto; }
  h2 { background: #6b4f2d; color: #fff; padding: 10px; border-radius: 8px; text-align: center; }
  label { margin-top: 10px; display: block; }
  input, select { width: 100%; padding: 10px; margin-top: 5px; margin-bottom: 15px; border-radius: 6px; border: 1px solid #ccc; }
  button { background: #6b4f2d; color: white; padding: 10px 20px; margin: 5px; border: none; border-radius: 6px; cursor: pointer; }
  button:hover { background: #543c22; }
  table { width: 100%; border-collapse: collapse; background: white; margin-top: 20px; }
  th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
  th { background: #ddd; }
  #lastMenu { background: #e0ffe0; padding: 10px; margin: 10px 0; border-left: 4px solid green; display: none; }
</style>
</head>
<body>

<h2>‚òï ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡∏≤‡πÅ‡∏ü</h2>

<label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á:</label>
<input id="nameInput" type="text" list="nameList" placeholder="‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠..." autocomplete="off" />
<datalist id="nameList"></datalist>
<div id="lastMenu"></div>

<label>‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏≤‡πÅ‡∏ü:</label>
<select id="menuInput">
  <option>A5</option>
  <option>A4.5</option>
  <option>A5+A4.5</option>
  <option>‡∏°‡∏±‡∏à‡∏â‡∏∞‡∏•‡∏≤‡πÄ‡∏ï‡πâ</option>
  <option>‡πÄ‡∏û‡∏µ‡∏¢‡∏ß‡∏°‡∏±‡∏à‡∏â‡∏∞</option>
  <option>Cold Brew</option>
</select>

<label>‡πÑ‡∏ã‡∏£‡∏±‡∏õ (‡∏Å‡∏£‡∏±‡∏°):</label>
<select id="syrupInput">
  <option value="">-- ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà --</option>
  <option>5</option>
  <option>10</option>
  <option>15</option>
  <option>20</option>
</select>

<label>‡∏ô‡πâ‡∏≥‡∏ú‡∏∂‡πâ‡∏á (‡∏Å‡∏£‡∏±‡∏°):</label>
<select id="honeyInput">
  <option value="">-- ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà --</option>
  <option>5</option>
  <option>10</option>
  <option>15</option>
  <option>20</option>
</select>

<button onclick="copyYesterday()">üìÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô</button>
<button onclick="exportPDF()">üì§ Export PDF</button>
<button onclick="clearOrders()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>

<h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
<table>
<thead>
<tr>
  <th>‡∏ä‡∏∑‡πà‡∏≠</th>
  <th>‡πÄ‡∏°‡∏ô‡∏π</th>
  <th>‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°</th>
  <th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
</tr>
</thead>
<tbody id="orderTable"></tbody>
</table>

<h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</h3>
<div id="summaryOutput"></div>

<script>
const nameInput = document.getElementById('nameInput');
const nameList = document.getElementById('nameList');
const menuInput = document.getElementById('menuInput');
const syrupInput = document.getElementById('syrupInput');
const honeyInput = document.getElementById('honeyInput');
const orderTable = document.getElementById('orderTable');
const summaryOutput = document.getElementById('summaryOutput');
const lastMenuDiv = document.getElementById('lastMenu');

let orders = JSON.parse(localStorage.getItem('coffeeOrders')) || [];
let memory = JSON.parse(localStorage.getItem('menuMemory')) || {};

function todayStr(offset = 0) {
  const d = new Date();
  d.setDate(d.getDate() + offset);
  return d.toLocaleDateString('th-TH');
}

function saveData() {
  localStorage.setItem('coffeeOrders', JSON.stringify(orders));
  localStorage.setItem('menuMemory', JSON.stringify(memory));
}

function updateNameList() {
  const names = [...new Set(orders.map(o => o.name))];
  nameList.innerHTML = names.map(n => `<option value="${n}">`).join('');
}

function showLastMenu() {
  const name = nameInput.value.trim();
  if (memory[name]) {
    lastMenuDiv.innerHTML = `<b>‡πÄ‡∏°‡∏ô‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥:</b> ${memory[name]}`;
    lastMenuDiv.style.display = 'block';
  } else {
    lastMenuDiv.style.display = 'none';
  }
}

function addOrUpdateOrder() {
  const name = nameInput.value.trim();
  if (!name) return;
  const menu = menuInput.value;
  const syrup = syrupInput.value;
  const honey = honeyInput.value;
  const mixParts = [];
  if (syrup) mixParts.push(`‡πÑ‡∏ã‡∏£‡∏±‡∏õ ${syrup}`);
  if (honey) mixParts.push(`‡∏ô‡πâ‡∏≥‡∏ú‡∏∂‡πâ‡∏á ${honey}`);
  const mix = mixParts.join(", ");
  const detail = `${menu}${mix ? " + " + mix : ""}`;

  const existing = orders.findIndex(o => o.name === name && o.date === todayStr());
  if (existing >= 0) orders[existing] = { name, menu, mix, date: todayStr() };
  else orders.push({ name, menu, mix, date: todayStr() });

  memory[name] = detail;
  saveData();
  renderOrders();
}

function renderOrders() {
  orderTable.innerHTML = '';
  orders.filter(o => o.date === todayStr()).forEach((o, i) => {
    orderTable.innerHTML += `<tr>
      <td>${o.name}</td>
      <td>${o.menu}</td>
      <td>${o.mix}</td>
      <td><button onclick="editOrder(${i})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td>
    </tr>`;
  });
  summarizeOrders();
  updateNameList();
}

function summarizeOrders() {
  const summary = {};
  orders.filter(o => o.date === todayStr()).forEach(o => {
    const key = `${o.menu}${o.mix ? " + " + o.mix : ""}`;
    summary[key] = (summary[key] || 0) + 1;
  });
  let html = "<ul>";
  for (let key in summary) html += `<li>${key} = ${summary[key]} ‡πÅ‡∏Å‡πâ‡∏ß</li>`;
  html += "</ul>";
  summaryOutput.innerHTML = html;
}

function editOrder(index) {
  const o = orders[index];
  nameInput.value = o.name;
  menuInput.value = o.menu;
  syrupInput.value = o.mix.includes("‡πÑ‡∏ã‡∏£‡∏±‡∏õ") ? o.mix.match(/‡πÑ‡∏ã‡∏£‡∏±‡∏õ (\d+)/)?.[1] : "";
  honeyInput.value = o.mix.includes("‡∏ô‡πâ‡∏≥‡∏ú‡∏∂‡πâ‡∏á") ? o.mix.match(/‡∏ô‡πâ‡∏≥‡∏ú‡∏∂‡πâ‡∏á (\d+)/)?.[1] : "";
  showLastMenu();
}

function clearOrders() {
  if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
    orders = [];
    saveData();
    renderOrders();
  }
}

function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡∏≤‡πÅ‡∏ü", 10, 15);
  let y = 25;
  orders.filter(o => o.date === todayStr()).forEach((o, index) => {
    doc.setFontSize(12);
    doc.text(`${index + 1}. ${o.name} - ${o.menu}${o.mix ? " + " + o.mix : ""}`, 10, y);
    y += 10;
  });
  doc.save(`Order-${todayStr()}.pdf`);
}

function copyYesterday() {
  const yesterdayOrders = orders.filter(o => o.date === todayStr(-1));
  if (yesterdayOrders.length === 0) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô");
  const toCopy = yesterdayOrders.filter(o => confirm(`‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ${o.name} ?`));
  toCopy.forEach(o => {
    if (!orders.some(t => t.name === o.name && t.date === todayStr())) {
      orders.push({ ...o, date: todayStr() });
    }
  });
  saveData();
  renderOrders();
}

// ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
      .then(reg => console.log('Service Worker registered.', reg))
      .catch(err => console.log('Service Worker registration failed:', err));
  });
}

[nameInput, menuInput, syrupInput, honeyInput].forEach(el =>
  el.addEventListener('change', () => {
    addOrUpdateOrder();
    showLastMenu();
  })
);

window.onload = () => {
  renderOrders();
  updateNameList();
};
</script>

</body>
</html>
